<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Node-data by ratneshsinghparihar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Node-data</h1>
      <h2 class="project-tagline"> Node-Data is a Node.js framework to expose rest data on level 3 (metadata and auto discovery).  This framework will allow declarative style (annotations) to handle most of backend concerns (data relations, transactions, rest, graphql , security) .</h2>
      <a href="https://github.com/ratneshsinghparihar/Node-Data" class="btn">View on GitHub</a>
      <a href="https://github.com/ratneshsinghparihar/Node-Data/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/ratneshsinghparihar/Node-Data/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p><a href="https://travis-ci.org/ratneshsinghparihar/Node-Data"><img src="https://travis-ci.org/ratneshsinghparihar/Node-Data.svg?branch=master" alt="Build Status"></a></p>

<h2>
<a id="what-is-node-data" class="anchor" href="#what-is-node-data" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What is Node-Data</h2>

<p>Node-Data is a Node.js framework to expose rest data on level 3 (metadata and auto discovery).</p>

<p>This framework will allow declarative style (annotations) to handle most of backend concerns (data relations, transactions, rest, graphql , security) .Yes its on javascript .</p>

<p>The target consumers are nodejs based scale projects looking for rewrite/new.</p>

<p>When you write for scale you might missed important aspect which might give you headache if you add the aspect late in your project. Node-Data will have most of aspects required in modern web scale project which can be enabled anytime using only annotations.</p>

<p>Rest level 3 is an amazing protocol allows the autodiscovery of system and application developers can write infrastructure for their code if backend api is level 3.</p>

<h2>
<a id="what-backend-concerns-will-be-handled" class="anchor" href="#what-backend-concerns-will-be-handled" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What backend concerns will be handled</h2>

<ol>
<li><p>Rest level 3 APIs</p></li>
<li><p>Model driven system</p></li>
<li><p>Data repositories(Only interface)</p></li>
<li><p>Auto rest end point generations from repositories</p></li>
<li><p>Relations using annotations (onetoone , onetomany , manytoone , manyttomany)</p></li>
<li><p>Embedded relations support (replication)</p></li>
<li><p>Transaction and services using annotations</p></li>
<li><p>DI container</p></li>
<li><p>Caching second level</p></li>
<li><p>Search and count (inbuilt elastic search)(repository and query dsl)</p></li>
<li><p>Logging and auditing using annotations</p></li>
<li><p>Graphql support</p></li>
<li><p>Meta-data API</p></li>
<li><p>Security (inbuilt authentication) ,role based autherization , acl</p></li>
<li><p>Everythingh is promise (no callback hell)</p></li>
<li><p>Validation</p></li>
</ol>

<h2>
<a id="technologies-used" class="anchor" href="#technologies-used" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Technologies used</h2>

<table>
<thead>
<tr>
<th>library</th>
<th>version</th>
<th>Comment/alternative</th>
</tr>
</thead>
<tbody>
<tr>
<td>nodejs</td>
<td>5.7.0</td>
<td>node</td>
</tr>
<tr>
<td>express</td>
<td>4.13.3</td>
<td>Rest middleware</td>
</tr>
<tr>
<td>TypeScript</td>
<td>1.8.4</td>
<td>Rest middleware</td>
</tr>
<tr>
<td>monogdb</td>
<td>2.1.3</td>
<td>Documetndb , nosql , auto sharding</td>
</tr>
<tr>
<td>Mongoose</td>
<td>4.3.5</td>
<td>ORM for mongoDB</td>
</tr>
<tr>
<td>Metadata-reflect</td>
<td>0.1.3</td>
<td>For reflection and metadata</td>
</tr>
<tr>
<td>gulp</td>
<td>3.9.0</td>
<td>Compiling Typscript and Build process</td>
</tr>
<tr>
<td>passport</td>
<td>0.2.2</td>
<td>Authentication , sso , OAtuh , jwt token</td>
</tr>
<tr>
<td>Npm-acl</td>
<td>0.4.9</td>
<td>Popular acl library</td>
</tr>
<tr>
<td>Elastic search</td>
<td>10.1.3</td>
<td>Search and aggregation</td>
</tr>
<tr>
<td>Mongosastic</td>
<td>4.0.2</td>
<td>Library for integrating Mongoose with ElasticSearch</td>
</tr>
<tr>
<td>redis</td>
<td>unknown</td>
<td>Rest middleware</td>
</tr>
</tbody>
</table>

<h2>
<a id="how-to-use-without-security" class="anchor" href="#how-to-use-without-security" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How To Use without security</h2>

<ol>
<li>Git clone <a href="https://github.com/hariadk/demo-sample.git">https://github.com/hariadk/demo-sample.git</a>
</li>
<li>cd demo-sample/Demo-Sample</li>
<li>npm install</li>
<li>tsd install</li>
<li>Mongodb running on 27017(default port).</li>
<li>Goto config.ts and make isAutheticationEnabled = 'disabled'</li>
<li>open cmd, run 'gulp compile-ts' then run gulp.</li>
<li>Post a JSON {"name":"john","":"john"} to http://localhost:9999/data/users.</li>
<li>Hit the api to get data(http://localhost:9999/data/users)</li>
<li>Ensure node version is 5.7.0</li>
</ol>

<h2>
<a id="how-to-use-with-security" class="anchor" href="#how-to-use-with-security" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How To Use with security</h2>

<p>Follow the below steps to start using the framework.</p>

<ol>
<li><p>Git clone <a href="https://github.com/hariadk/demo-sample.git">https://github.com/hariadk/demo-sample.git</a></p></li>
<li><p>cd demo-sample/Demo-Sample</p></li>
</ol>

<h2>
<a id="create-a-new-user" class="anchor" href="#create-a-new-user" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create a new user</h2>

<ol>
<li><p>POST {
"user":{"name":"a111","password":"a"}
}
in http://localhost:9999/register.
This will create a new user in db.</p></li>
<li><p>Now we can use this user information to login, for both session based and token based authentication</p></li>
<li><p>If we need to change the logic for user creation, change the method getNewUser in current-user-detail-service.ts file.Sample code is in place.</p></li>
</ol>

<p>For using session based authentication use below steps:</p>

<ol>
<li><p>Do above steps 1 &amp; 2</p></li>
<li><p>Checkout branch PasswordAuth</p></li>
<li><p>npm install</p></li>
<li><p>tsd install</p></li>
<li><p>Mongodb running on 27017(default port).</p></li>
<li><p>Post a JSON {"name":"john","":"john"} to http://localhost:9999/data/users. This will create a test user in db.</p></li>
<li><p>open cmd, run 'gulp compile-ts' then run gulp.</p></li>
<li><p>Hit http://localhost:9999 which will take you to login page.</p></li>
<li><p>use john as username and password, and a session will be created.</p></li>
</ol>

<p>For using Token based auth use below steps</p>

<ol>
<li><p>All the steps done above except checkout branch TokenAuth.</p></li>
<li><p>Once logged in , a token will be created.</p></li>
<li><p>To change the token expiring time, change the file security-config.ts.
public static tokenExpiresInMinutes: number = 2;//2 minutes</p></li>
<li><p>The number indicates minutes of token expiry not hours.</p></li>
</ol>

<h2>
<a id="rest-level-3-apis" class="anchor" href="#rest-level-3-apis" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Rest level 3 APIs</h2>

<p>Node-data exposes the entities as level 3 REST APIs in HAL format. 
Read more about: 
<a href="http://stateless.co/hal_specification.html">HAL specification</a> </p>

<p><a href="http://martinfowler.com/articles/richardsonMaturityModel.html">Rest API levels</a> </p>

<p>In short, REST level 3 in addition to HTTP verbs(get, put, post etc.) introduces the concept of discoverability. 
When we navigate to the base-url(assuming base-url for API is "http://localhost:8080/data/") for API, we get all the exposed rest APIs in the system. </p>

<div class="highlight highlight-source-json"><pre>[ 
  { 
   <span class="pl-s"><span class="pl-pds">"</span>roles<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/data/roles<span class="pl-pds">"</span></span> 
  }, 
  { 
   <span class="pl-s"><span class="pl-pds">"</span>users<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/data/users<span class="pl-pds">"</span></span> 
  } 
] </pre></div>

<h3>
<a id="suppose-we-want-to-get-all-the-users-in-the-system-we-go-to-httplocalhost8080datausers" class="anchor" href="#suppose-we-want-to-get-all-the-users-in-the-system-we-go-to-httplocalhost8080datausers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Suppose we want to get all the users in the system, we go to: "http://localhost:8080/data/users".</h3>

<div class="highlight highlight-source-json"><pre>{ 
  <span class="pl-s"><span class="pl-pds">"</span>_links<span class="pl-pds">"</span></span>: { 
   <span class="pl-s"><span class="pl-pds">"</span>self<span class="pl-pds">"</span></span>: { 
    <span class="pl-s"><span class="pl-pds">"</span>href<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/data/users<span class="pl-pds">"</span></span> 
   }, 
   <span class="pl-s"><span class="pl-pds">"</span>search<span class="pl-pds">"</span></span>: { 
    <span class="pl-s"><span class="pl-pds">"</span>href<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/data/users/search<span class="pl-pds">"</span></span> 
   }, 
   <span class="pl-s"><span class="pl-pds">"</span>action<span class="pl-pds">"</span></span>: { 
    <span class="pl-s"><span class="pl-pds">"</span>href<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/data/users/action<span class="pl-pds">"</span></span> 
   }  
  }, 
  <span class="pl-s"><span class="pl-pds">"</span>_embedded<span class="pl-pds">"</span></span>: [ 
   { 
    <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>56d692a24043588c0c713564<span class="pl-pds">"</span></span>, 
    <span class="pl-s"><span class="pl-pds">"</span>email<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>alex.b@xyz.com<span class="pl-pds">"</span></span>, 
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Alex Brown<span class="pl-pds">"</span></span>, 
    <span class="pl-s"><span class="pl-pds">"</span>_links<span class="pl-pds">"</span></span>: { 
     <span class="pl-s"><span class="pl-pds">"</span>self<span class="pl-pds">"</span></span>: { 
      <span class="pl-s"><span class="pl-pds">"</span>href<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/data/users/56d692a24043588c0c713564<span class="pl-pds">"</span></span> 
     }, 
     <span class="pl-s"><span class="pl-pds">"</span>roles<span class="pl-pds">"</span></span>:{ 
      <span class="pl-s"><span class="pl-pds">"</span>href<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/data/users/56d692a24043588c0c713564/roles<span class="pl-pds">"</span></span> 
     } 
    } 
   }, 
   { 
    <span class="pl-s"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>56d692be4043588c0c713565<span class="pl-pds">"</span></span>, 
    <span class="pl-s"><span class="pl-pds">"</span>email<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>daniel.j@xyz.com<span class="pl-pds">"</span></span>, 
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Daniel Jones<span class="pl-pds">"</span></span>, 
    <span class="pl-s"><span class="pl-pds">"</span>_links<span class="pl-pds">"</span></span>: { 
     <span class="pl-s"><span class="pl-pds">"</span>self<span class="pl-pds">"</span></span>: { 
      <span class="pl-s"><span class="pl-pds">"</span>href<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/data/users/56d692be4043588c0c713565<span class="pl-pds">"</span></span> 
     }, 
     <span class="pl-s"><span class="pl-pds">"</span>roles<span class="pl-pds">"</span></span>:{ 
      <span class="pl-s"><span class="pl-pds">"</span>href<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://localhost:8080/data/users/56d692be4043588c0c713565/roles<span class="pl-pds">"</span></span> 
     } 
    } 
   } 
  ] 
} </pre></div>

<p>If we want to fetch all the roles for any user, we can simply fetch the roles url from inside the "_links" object for the given user. We just need to know what the base URL is, and after that we just follow the links to get any entity, its relations and so on. </p>

<h2>
<a id="model-driven-system" class="anchor" href="#model-driven-system" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Model driven system</h2>

<p>A model driven system allow one to build a solid backend by defining model . Convention approach enables developers to define specification on models and those specifications can be execute by framework or implemented by developer it self .  </p>

<div class="highlight highlight-source-ts"><pre>@document({ name: <span class="pl-s">'students'</span>, strict: Strict.<span class="pl-c1">true</span> })
<span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">StudentModel</span> {
    @<span class="pl-en">field</span>({ <span class="pl-v">primary</span>: true, <span class="pl-v">autogenerated</span>: true })
    _id: Types.ObjectId;

    @<span class="pl-en">field</span>()
    name: <span class="pl-k">string</span>;

    @<span class="pl-en">field</span>()
    age: <span class="pl-k">number</span>;

    @<span class="pl-en">field</span>()
    gender: <span class="pl-k">string</span>;

    @<span class="pl-en">onetomany</span>({ <span class="pl-v">rel</span>: <span class="pl-s">'courses'</span>, <span class="pl-v">itemType</span>: CourseModel, <span class="pl-v">embedded</span>: true })
    course: CourseModel.CourseModel;
    }</pre></div>

<p>Here the Student Model has attribute is decorated with document with name student which will tell the system to persist each Student Model as a document with name student and schema will be restricted.</p>

<p><a href="https://github.com/Field" class="user-mention">@Field</a> will provide the specification for fields in model like primarykey , string field etc. <a href="https://github.com/oneToMany" class="user-mention">@oneToMany</a> annotation will build a embedded relation with couseModel in the system.</p>

<h2>
<a id="data-repositories-only-interface" class="anchor" href="#data-repositories-only-interface" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Data repositories (Only interface)</h2>

<p>Data repository exposes the basic CRUD operations for a defined model which can be used anywhere in application whether services or controllers. It also allows rest path definition and  authorization settings using attributes. The framework will automatically create the implementation of the interface which can be overridden by developer if required.</p>

<div class="highlight highlight-source-ts"><pre>@repository({ path: <span class="pl-s">'blogs'</span>, model: BlogModel })
<span class="pl-k">export</span> <span class="pl-k">interface</span> <span class="pl-en">BlogRepository</span> <span class="pl-k">extends</span> <span class="pl-k">dataRepository</span> {
    <span class="pl-en">findByName</span>();
    <span class="pl-en">doPublish</span>();
}</pre></div>

<p>Here the basic CRUD operations (findone , finadall , save , saveall , delete,page) will be provided by dataRepository. custom methods can be define here and will be immplemented in services.</p>

<h2>
<a id="auto-rest-end-point-generations-from-repositories" class="anchor" href="#auto-rest-end-point-generations-from-repositories" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Auto rest end point generations from repositories</h2>

<p>Once the repository interface defined the framework will automatically generates the rest point . In otherward as a developer you don't need to create the controllers. </p>

<p>like for above BlogRepository the framework will generate and handle following automatically</p>

<div class="highlight highlight-text-html-basic"><pre>findOne
Get http://localhost:8080/data/blogs/1/
findAll
Get http://localhost:8080/data/blogs/
create
Post http://localhost:8080/data/blogs/
update
Put http://localhost:8080/data/blogs/1/
delete
Delete http://localhost:8080/data/blogs/1/
</pre></div>

<p>for Custom methods the framework will generate and handle url like</p>

<div class="highlight highlight-text-html-basic"><pre>http://localhost:8080/data/blogs/search/findByName?name=testblog
http://localhost:8080/data/blogs/action/doPublish/</pre></div>

<p>If custom logic need to be added or entire repository action (like save) need to overridden then a service can be created for the custom logic and service method invocation can be done by defining in attribute over the respective repository's method like below (here we want to do logging after the save) </p>

<div class="highlight highlight-source-ts"><pre>@PostAuthorize(<span class="pl-s">"@currentUserAutherizationServiceImpl.logSavedEntity(principal, returnObject)"</span>) 
<span class="pl-k">&lt;</span>S extends T<span class="pl-k">&gt;</span> S save(S entity); </pre></div>

<h2>
<a id="relations-using-annotations-one-to-one--onetomany--manytoone--manyttomany" class="anchor" href="#relations-using-annotations-one-to-one--onetomany--manytoone--manyttomany" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Relations using annotations (one to one , onetomany , manytoone , manyttomany)</h2>

<p>Relations between models can be established by adding following declarations. To explain we will be using following entities. </p>

<div class="highlight highlight-source-ts"><pre>@document({ name: <span class="pl-s">'subjects'</span>, strict: Strict.<span class="pl-c1">true</span> }) 
<span class="pl-k">class</span> <span class="pl-en">SubjectModel</span> { 
    @<span class="pl-en">field</span>() 
    name: <span class="pl-k">string</span>; 
} 

@document({ name: <span class="pl-s">'students'</span>, strict: Strict.<span class="pl-c1">true</span> }) 
<span class="pl-k">class</span> <span class="pl-en">StudentModel</span> { 
    @<span class="pl-en">field</span>() 
    name: <span class="pl-k">string</span>; 
} 

@document({ name: <span class="pl-s">'teachers'</span>, strict: Strict.<span class="pl-c1">true</span> }) 
<span class="pl-k">class</span> <span class="pl-en">TeacherModel</span> { 
    @<span class="pl-en">field</span>() 
    name: <span class="pl-k">string</span>; 
} </pre></div>

<h3>
<a id="onetomany" class="anchor" href="#onetomany" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>OneToMany</h3>

<p>One-to-many refers to the relationship between two entities A and B in which an element of A may be linked to many elements of B, but a member of B is linked to only one element of A.  </p>

<p>For instance, think of A as mentor, and B as student. A mentor can have several students, but a student can have only one mentor. Following code snippet establish this relation on Teacher entity. </p>

<div class="highlight highlight-source-ts"><pre>@document({ name: <span class="pl-s">'teachers'</span>, strict: Strict.<span class="pl-c1">true</span> }) 
<span class="pl-k">class</span> <span class="pl-en">TeacherModel</span> { 
    @<span class="pl-en">field</span>() 
    name: <span class="pl-k">string</span>; 
    @<span class="pl-en">onetomany</span>({ <span class="pl-v">rel</span>: <span class="pl-s">'students'</span>, <span class="pl-v">itemType</span>: StudentModel, <span class="pl-v">embedded</span>: false }) 
    mentoring: <span class="pl-en">Array</span>&lt;StudentModel&gt;; 
} </pre></div>

<p>We have different keywords while declaring the relation. These keywords are used in all the declaration. They are explained as below: 
Name 
Description 
Rel 
Set document name to which this property is mapped to<br>
itemType 
Set Entity type to which property is mapped to 
embedded 
Set to true will embed whole document as property value otherwise only primary key will be set as property value </p>

<h3>
<a id="manytoone" class="anchor" href="#manytoone" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ManyToOne</h3>

<p>Many-to-one is vice-versa implementation of one-to-many relation. It’s just that entity is present on other end.<br>
We will use example from OneToMany example and add that relation on Student entity. </p>

<div class="highlight highlight-source-ts"><pre>@document({ name: <span class="pl-s">'students'</span>, strict: Strict.<span class="pl-c1">true</span> }) 
<span class="pl-k">class</span> <span class="pl-en">StudentModel</span> { 
    @<span class="pl-en">field</span>() 
    name: <span class="pl-k">string</span>; 
    @<span class="pl-en">manytoone</span>({ <span class="pl-v">rel</span>: <span class="pl-s">'students'</span>, <span class="pl-v">itemType</span>: TeacherModel, <span class="pl-v">embedded</span>: false }) 
    mentor: TeacherModel; 
} </pre></div>

<h3>
<a id="onetoone" class="anchor" href="#onetoone" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>OneToOne</h3>

<p>One-to-one refers to the relationship between two entities A and B in which one element of A may only be linked to one element of B, and vice versa.
For instance, think of A as teacher, and B as subject. A teacher has only one subject, and a subject is taught by only one teacher. Following code snippet establish this relation on Teacher entity.</p>

<div class="highlight highlight-source-ts"><pre>@document({ name: <span class="pl-s">'teachers'</span>, strict: Strict.<span class="pl-c1">true</span> })
<span class="pl-k">class</span> <span class="pl-en">TeacherModel</span> { 
    @<span class="pl-en">field</span>() 
    name: <span class="pl-k">string</span>; 
    @<span class="pl-en">onetoone</span>({ <span class="pl-v">rel</span>: <span class="pl-s">'subjects'</span>, <span class="pl-v">itemType</span>: SubjectModel, <span class="pl-v">embedded</span>: false })
    subject: SubjectModel; 
}  </pre></div>

<h3>
<a id="manytomany" class="anchor" href="#manytomany" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ManyToMany</h3>

<p>Many-to-many refers to the relationship between two entities A and B in which A may contain a parent record for which there are many children in B and vice versa.
For instance, think of A as Student, and B as Subject. A student can have several subjects, and a subject can be taken by several students. Following code snippet establish this relation on Student entity.</p>

<div class="highlight highlight-source-ts"><pre>@document({ name: <span class="pl-s">'students'</span>, strict: Strict.<span class="pl-c1">true</span> })
<span class="pl-k">class</span> <span class="pl-en">StudentModel</span> {
    @<span class="pl-en">field</span>()
    name: <span class="pl-k">string</span>;
    @<span class="pl-en">manytomany</span>({ <span class="pl-v">rel</span>: <span class="pl-s">'subjects'</span>, <span class="pl-v">itemType</span>: SubjectModel, <span class="pl-v">embedded</span>: false }) 
    subjects: <span class="pl-en">Array</span>&lt;SubjectModel&gt;;
}</pre></div>

<h2>
<a id="embedded-relations-support-replication" class="anchor" href="#embedded-relations-support-replication" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Embedded relations support (<em>replication</em>)</h2>

<p>A relation can be saved two ways: 
1. Link to the related document 
2. Embed the related document 
Embedding document helps to get the object and relational data using single query from database thus reducing the database/server hits. This behaviour is managed by using ‘embedded’ keyword. When set to true, it fetches the document and embed whole document into the property. In this case, document is replicated and managed by the system. All the embedded document’s update/delete will automatically update the parent document. </p>

<p><em>For embedded, please make sure that there is no circular embedding into the system. Although system checks for any circular embedding of the object and throws error.</em> </p>

<p>Transaction and services using annotations - (Not Yet Implemented) 
At the moment, transaction is not supported. But eventually, we will support basic transactions using <a href="https://github.com/transactional" class="user-mention">@transactional</a> annotation.<br>
Refer to: <a href="https://docs.mongodb.org/manual/tutorial/perform-two-phase-commits/">Website</a> for mongodb transaction. </p>

<h2>
<a id="di-container" class="anchor" href="#di-container" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DI container</h2>

<p>Node-data implements a light-weight annotation driven dependency-injection container. All the services(<a href="https://github.com/service" class="user-mention">@service</a>) and repositories(<a href="https://github.com/repository" class="user-mention">@repository</a>) can be injected in other classes. Construction injection (only for services) and property injection are supported currently. To inject the dependency, use the annotation <a href="https://github.com/inject" class="user-mention">@inject</a>. <a href="https://github.com/inject" class="user-mention">@inject</a> takes optional "type" parameter. When type cannot be inferred from the usage (interface or other types), we can pass the "concrete" type as a parameter to inject. 
Currently, we support concrete types only. If anyone wants to use interfaces, check out <a href="http://inversify.io/">Website</a> for more. </p>

<p><em>Usage</em></p>

<div class="highlight highlight-source-ts"><pre>@service({singleton: <span class="pl-c1">true</span>}) 
<span class="pl-k">class</span> <span class="pl-en">MyService</span>{ 
... 
} </pre></div>

<p><em>Inject dependency in another service(constructor and property)</em> </p>

<div class="highlight highlight-source-ts"><pre>@service() 
<span class="pl-k">class</span> <span class="pl-en">MyAnotherService</span>{ 
@<span class="pl-en">inject</span>() 
private myServiceAsProp: MyService; 

<span class="pl-c">// constructor injection </span>
<span class="pl-en">constructor</span>(@<span class="pl-v">inject</span>() myService: MyService){ 
} 
} </pre></div>

<p><em>Inject dependency in any another class(only property injection as of now)</em></p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">class</span> <span class="pl-en">MyNormalClass</span> { 
@<span class="pl-en">inject</span>() 
private myService: MyService; 
@<span class="pl-en">inject</span>() 
private myAnotherService: MyAnotherService; 
}</pre></div>

<h2>
<a id="caching-second-level" class="anchor" href="#caching-second-level" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Caching second level</h2>

<p>The proposal for caching is like below</p>

<div class="highlight highlight-source-ts"><pre>@document({ name: <span class="pl-s">'courses'</span>, strict: Strict.throw })
@cache({expirtion: Policy.Update ,concurrencyStrategy:Strategy.Read_Write })
<span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">CourseModel</span> {
    @<span class="pl-en">field</span>({ <span class="pl-v">primary</span>: true, <span class="pl-v">autogenerated</span>: true })
    _id: Types.ObjectId;

    @<span class="pl-en">field</span>()
    name: String;

    @<span class="pl-en">onetomany</span>({ <span class="pl-v">rel</span>: <span class="pl-s">'teachers'</span>, <span class="pl-v">biDirectional</span>: true})
    @cache
    teachers: <span class="pl-en">Array</span>&lt;TM.TeacherModel&gt;;

    @<span class="pl-en">manytomany</span>({<span class="pl-v">rel</span>: <span class="pl-s">'students'</span>, <span class="pl-v">biDirectional</span>: false})
    students: <span class="pl-en">Array</span>&lt;SM.StudentModel&gt;;
}</pre></div>

<p>In above example the courses in the system will be cached as per policy and concurrency defined . if you look for teachers for a course that will be served by the cache but if you look for students for a course that will come from persitent in lazy loading manner.</p>

<p>The choice for Caching (Redis , memcahed ,local) and its setting can be define in config.ts file.</p>

<h2>
<a id="search-and-count-inbuilt-elastic-searchrepository-and-query-dsl" class="anchor" href="#search-and-count-inbuilt-elastic-searchrepository-and-query-dsl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Search and count (inbuilt elastic search)(repository and query dsl)</h2>

<h3>
<a id="searching" class="anchor" href="#searching" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Searching</h3>

<p>Searching is done on MongoDB by default. 
Provision is made to search using elasticsearch by changing the settings in the Config file. 
Search on elasticsearch is currently done only on fields that are indexed in the elasticsearch. 
All the search methods are needed to be exposed on the Repository. 
Currently only the "And" search operations are supported. </p>

<h3>
<a id="configuring-elasticsearch" class="anchor" href="#configuring-elasticsearch" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuring ElasticSearch:</h3>

<h3>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation:</h3>

<p>Elastic search can be installed from <a href="https://www.elastic.co/">https://www.elastic.co/</a></p>

<h3>
<a id="config-class" class="anchor" href="#config-class" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Config Class:</h3>

<p>Set "ApplyElasticSearch" to true to enable ElasticSearch 
Set the path of the ElasticSearch service at "ElasticSearchConnection" </p>

<h3>
<a id="model-class" class="anchor" href="#model-class" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Model Class:</h3>

<p>For all the fields where the ElasticSearch indexing is requried, set the property in "<a href="https://github.com/field" class="user-mention">@field</a>" as "searchIndex:true" 
e.g. As in the "name" and "age" properties, the searchIndex is set to true. </p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">class</span> <span class="pl-en">PersonModel</span> { 
    @<span class="pl-en">field</span>({<span class="pl-v">searchIndex</span> : true}) 
    name: <span class="pl-k">string</span>; 

    @<span class="pl-en">field</span>() 
    lastname: <span class="pl-k">string</span>; 

    @<span class="pl-en">field</span>({<span class="pl-v">searchIndex</span> : true}) 
    age: <span class="pl-k">number</span>; 

    <span class="pl-en">constructor</span>(){ 
    }
} </pre></div>

<h3>
<a id="configuring-search" class="anchor" href="#configuring-search" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuring Search:</h3>

<p>All the search methods are defined at the Repository classes. 
Currently the methods are needed to be defined in a fixed format.<br>
The method name should start with "findBy".<br>
It should then be followed by all the fields that are needed to be searched joined by "And" </p>

<p>e.g. </p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">class</span> <span class="pl-en">PersonRepository</span> { 
    <span class="pl-en">findByName</span>() { 
    } 
    <span class="pl-en">findByNameAndAge</span>() { 
    } 
    <span class="pl-en">findByNameAndLastname</span>(){ 
    } 
} </pre></div>

<h3>
<a id="how-the-search-happens" class="anchor" href="#how-the-search-happens" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How the search happens:</h3>

<p>The API's are defined in such a way that if ALL of the fields to be searched are indexed, then the data is fetched from ElasticSearch. 
If any one the fields to be searched is NOT indexed in ElasticSearch, the data is fetched from MongoDB. 
Let us consider the above mentioned "PersonModel" and "PersonRepository" 
The methods "findByName" and "findByNameAndAge", queries using the fields "name" and "age". Since they are defined as Indexed, the data will be fetched from ElasticSearch. 
The method "findByNameAndLastname", queries "name" and "lastname". Since "lastname" is not defined as indexed, the data will be fetched from MongoDB. </p>

<h2>
<a id="logging" class="anchor" href="#logging" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Logging</h2>

<p>It will be completely on developers hand , The framework will allow the metadata of a class , method with logging attribute to be accessible to developers.
User can also inject the logger using DI.</p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">class</span> <span class="pl-en">Calculator</span>{
    @log
    <span class="pl-en">add</span>(<span class="pl-v">a</span>: <span class="pl-k">number</span>, <span class="pl-v">b</span>: <span class="pl-k">number</span>){
        <span class="pl-k">return</span> a <span class="pl-k">+</span> b;
    }
}</pre></div>

<h2>
<a id="auditing" class="anchor" href="#auditing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Auditing</h2>

<p>The proposal for Auditing is <a href="https://github.com/Audit" class="user-mention">@Audit</a> attribute which can be applied over model or over repository or in both.</p>

<div class="highlight highlight-source-ts"><pre>@Audit({auditModel: CourseAuditModel})
<span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">CourseModel</span> {
}</pre></div>

<p>If appllied over model then developer needs to create a audit schema model similar to current model , remove any non auditable field and add audit fields (createdby, lastmodifiedby, deletedby, createddate, lastmodifieddatae) (or extend from). then this new audit schema model need to be passed as a parameter in attribute. If no schmea is provided then framework will autmatically create audit schema including all columns.</p>

<div class="highlight highlight-source-ts"><pre>@repository({ path: <span class="pl-s">'blogs'</span>, model: BlogModel })
<span class="pl-k">export</span> <span class="pl-k">interface</span> <span class="pl-en">BlogRepository</span> <span class="pl-k">extends</span> <span class="pl-k">dataRepository</span> {
    @Audit
    <span class="pl-en">save</span>();
}</pre></div>

<p>If appllied over repository then all write opertation will be audited in a dedicated document for the model.</p>

<h2>
<a id="optimistic-locking" class="anchor" href="#optimistic-locking" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Optimistic Locking</h2>

<p>The docuement databases are infamous for concurrent updates . in high concurrency the situation multifolds itself. we are proposing a simple mechanism of optimatic locking by decorating the suspected method on repository by</p>

<div class="highlight highlight-source-ts"><pre>@OptimisticLocking(type <span class="pl-k">=</span> OptimisticLockType.VERSION)
save()</pre></div>

<p>in other to support it the corresponding model should have a column decorated with <a href="https://github.com/version" class="user-mention">@version</a> attribute</p>

<div class="highlight highlight-source-ts"><pre>@Version
@JsonIgnore
@field(name <span class="pl-k">=</span> <span class="pl-s">"version"</span>)
version: int;</pre></div>

<p><a href="https://github.com/version" class="user-mention">@version</a> attribute could be applied to int , date fields. Once this is done , for every write query the version check will be apllied hence if somone has stale data it won't be allowed to write.</p>

<h2>
<a id="graphql-support" class="anchor" href="#graphql-support" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Graphql support</h2>

<p>For Graphql, atrribute over the  Model will enable the graph queries to be executed.like </p>

<div class="highlight highlight-source-ts"><pre>@document({ name: <span class="pl-s">'users'</span>, strict: Strict.<span class="pl-c1">true</span> }) 
@Graphql
<span class="pl-k">class</span> <span class="pl-en">UserModel</span> { 
    @<span class="pl-en">field</span>() 
    name: <span class="pl-k">string</span>; 
    @<span class="pl-en">manytomany</span>({ <span class="pl-v">rel</span>: <span class="pl-s">'friends'</span>, <span class="pl-v">itemType</span>: FreindModel, <span class="pl-v">embedded</span>: true }) 
    friends: <span class="pl-en">Array</span>&lt;FriendModel&gt;; 
} </pre></div>

<p>Once define like above the framework will automatically add GraphqlObjectType and GraphqlSchema.</p>

<p>Example GraphQL query (request body for post on /user/grpahql/):</p>

<div class="highlight highlight-source-js"><pre><span class="pl-en">user</span>(<span class="pl-smi">id</span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span>) {
  name
  friends {
    name
  }
}</pre></div>

<p>Example response:</p>

<div class="highlight highlight-source-json"><pre>{
  <span class="pl-s"><span class="pl-pds">"</span>data<span class="pl-pds">"</span></span>: {
    <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>: {
      <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>John Doe<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>friends<span class="pl-pds">"</span></span>: [
        {
          <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Friend One<span class="pl-pds">"</span></span>
        },
        {
          <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Friend Two<span class="pl-pds">"</span></span>
        }]
      }
    }
  }</pre></div>

<p>Example GraphQL mutation:</p>

<div class="highlight highlight-source-js"><pre>mutation <span class="pl-en">updateUser</span>(<span class="pl-smi">$userId</span><span class="pl-k">:</span> <span class="pl-c1">String</span><span class="pl-k">!</span> <span class="pl-smi">$name</span><span class="pl-k">:</span> <span class="pl-c1">String</span><span class="pl-k">!</span>) {
  <span class="pl-en">updateUser</span>(<span class="pl-smi">id</span><span class="pl-k">:</span> <span class="pl-smi">$userId</span> <span class="pl-smi">name</span><span class="pl-k">:</span> <span class="pl-smi">$name</span>) {
    name
  }
}</pre></div>

<h2>
<a id="meta-data-api" class="anchor" href="#meta-data-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Meta-data API</h2>

<p>Metadata gives the structure of the object. The structure consists of the properties defined in the entities. </p>

<p>For e.g. ‘http://localhost/metadata’ will return all the objects metadata : </p>

<div class="highlight highlight-source-json"><pre>{ 
  <span class="pl-s"><span class="pl-pds">"</span>_links<span class="pl-pds">"</span></span>: [ 
    { 
      <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>subjects<span class="pl-pds">"</span></span>, 
      <span class="pl-s"><span class="pl-pds">"</span>metadata<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://localhost/Metadata/subjects<span class="pl-pds">"</span></span> 
    }, 
    { 
      <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>students<span class="pl-pds">"</span></span>, 
      <span class="pl-s"><span class="pl-pds">"</span>metadata<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://localhost/Metadata/students<span class="pl-pds">"</span></span> 
    }, 
    { 
      <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>teachers<span class="pl-pds">"</span></span>, 
      <span class="pl-s"><span class="pl-pds">"</span>metadata<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>http://localhost/Metadata/teachers<span class="pl-pds">"</span></span> 
    } 
  ] 
} </pre></div>

<p>Further running ‘http://localhost/Metadata/students’ will give:</p>

<div class="highlight highlight-source-json"><pre>{ 
  <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>students<span class="pl-pds">"</span></span>, 
  <span class="pl-s"><span class="pl-pds">"</span>properties<span class="pl-pds">"</span></span>: [ 
    { 
      <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>, 
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>String<span class="pl-pds">"</span></span> 
    }, 
    { 
      <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>subjects<span class="pl-pds">"</span></span>, 
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: [ 
        <span class="pl-s"><span class="pl-pds">"</span>http://localhost/Metadata/subjects<span class="pl-pds">"</span></span> 
      ] 
    } 
  ] 
} </pre></div>

<p>For primitive types, name of the type is shown.  If the entity has a relationship with another entity then the link of that object's metadata is shown. </p>

<h2>
<a id="security-inbuilt-authentication-role-based-autherization--acl" class="anchor" href="#security-inbuilt-authentication-role-based-autherization--acl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Security (inbuilt authentication) ,role based autherization , acl</h2>

<h3>
<a id="system-has-two-types-of-inbuilt-authentication" class="anchor" href="#system-has-two-types-of-inbuilt-authentication" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>System has two types of inbuilt authentication:</h3>

<ol>
<li>
<em>Session based</em> </li>
<li>
<em>Token based</em> </li>
</ol>

<h3>
<a id="session-based" class="anchor" href="#session-based" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Session based</h3>

<p>It takes the username and password from a user, validates it against the user document in the mongodb. If user is found it creates a session for it. 
To use this a user needs to edit the config.ts file. </p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">Security</span> { 
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-v">isAutheticationEnabled</span>: <span class="pl-k">boolean</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>; 
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-v">isAuthorizationEnabled</span>: <span class="pl-k">boolean</span> <span class="pl-k">=</span> <span class="pl-c1">false</span>; 
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-v">isAutheticationByUserPasswd</span>: <span class="pl-k">boolean</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>; 
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-v">isAutheticationByToken</span>: <span class="pl-k">boolean</span> <span class="pl-k">=</span> <span class="pl-c1">false</span>; 
} </pre></div>

<p>Both isAutheticationEnabled  and isAutheticationByUserPasswd should be set to TRUE.<br>
isAutheticationByUserPasswd  and  isAutheticationByToken are mutually exclusive.   </p>

<h3>
<a id="token-based" class="anchor" href="#token-based" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Token Based</h3>

<p>It takes the username and password from a user, validates it against the user document in the mongodb. If user is found it creates a token and a refreshToken for that user, and stores in user document itself. Session is not created in this case.<br>
The token expiry time can be set in security-config.ts file. </p>

<div class="highlight highlight-source-ts"><pre>public static tokenExpiresInMinutes: <span class="pl-k">number</span> <span class="pl-k">=</span> <span class="pl-c1">2</span>;<span class="pl-c">//2 minutes. </span></pre></div>

<p>The token is set in the cookies and sent to the browser.Using that token, user is considered valid, and provided access to the system. 
Once the token is expired, user can just hit the /token API with refreshToken as the query param. RefreshToken value can be found in the browser cookies. This API will generate a new token for the user, and replace the old token in the user document in the DB, as well as in the cookies. Using the new token user can access the system again, without having to login again and again. </p>

<p>To enable token based authentication just edit the config.ts file in following manner </p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">Security</span> { 
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-v">isAutheticationEnabled</span>: <span class="pl-k">boolean</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>; 
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-v">isAuthorizationEnabled</span>: <span class="pl-k">boolean</span> <span class="pl-k">=</span> <span class="pl-c1">false</span>; 
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-v">isAutheticationByUserPasswd</span>: <span class="pl-k">boolean</span> <span class="pl-k">=</span> <span class="pl-c1">false</span>; 
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-v">isAutheticationByToken</span>: <span class="pl-k">boolean</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>; 
} </pre></div>

<p>Currently any user who is AUTHENTICATED, has access to the entire DB. This is because, AUTHORIZATION is not implemented. In the absence of authorization, the user has access to every document in the db. </p>

<h3>
<a id="facebook-authenticationsso" class="anchor" href="#facebook-authenticationsso" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>FaceBook Authentication(SSO)</h3>

<p>Facebook authentication uses facebook to authenticate a user. If the user is present in the db, it stores the token in the user document and creates a session for the user in the application. In case its a new user, it first creates the user in the DB and then creates a session for the user in the application. 
To enable it the only thing needs to be done is in the config.ts file. </p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">Security</span> {
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-v">isAutheticationEnabled</span>: <span class="pl-k">boolean</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>;
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-v">isAuthorizationEnabled</span>: <span class="pl-k">boolean</span> <span class="pl-k">=</span> <span class="pl-c1">false</span>;
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-v">isAutheticationByUserPasswd</span>: <span class="pl-k">boolean</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>; 
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-v">isAutheticationByToken</span>: <span class="pl-k">boolean</span> <span class="pl-k">=</span> <span class="pl-c1">false</span>; 
}</pre></div>

<h2>
<a id="everything-is-promise-no-callback-hell" class="anchor" href="#everything-is-promise-no-callback-hell" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Everything is promise (<em>no callback hell</em>)</h2>

<p>Callback-Hell in nodejs occurs when we have multiple levels of callbacks(as shown in the sample below). This severely affects readablitly of the code. Node-data internally uses <a href="https://github.com/kriskowal/q/wiki/API-Reference">Q</a> to wrap the function calls and returns a promise. Using Promise chains flattens the pyramid and the code is cleaner.</p>

<div class="highlight highlight-source-ts"><pre> <span class="pl-k">return</span> Q.nbind(<span class="pl-c1">this</span>.find, <span class="pl-c1">this</span>)(params)
        .then(result <span class="pl-k">=&gt;</span> doSomething(params1))
        .then(result <span class="pl-k">=&gt;</span> doSomethingElse(params2))
        ...
        .catch(error <span class="pl-k">=&gt;</span> Q.reject(error))</pre></div>

<p>Instead of (Callback hell):</p>

<div class="highlight highlight-source-ts"><pre><span class="pl-c1">this</span>.find(params, (error, data) <span class="pl-k">=&gt;</span> {
    doSomething(params1, (error, data) <span class="pl-k">=&gt;</span> {
        doSomethingElse(params2, (error, data) <span class="pl-k">=&gt;</span> {
            ...
        });
    });
})</pre></div>

<h2>
<a id="validation" class="anchor" href="#validation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Validation</h2>

<p>Proposal is to create a validation service where annotations will be used to validate required attributes in any entity.</p>

<p>For example check below code fragment</p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">class</span> <span class="pl-en">UserModel</span> { 

    @<span class="pl-en">field</span>() 
    @<span class="pl-en">NotNull</span>() <span class="pl-c">// to ensure that this attribute is never null</span>
    name: <span class="pl-k">string</span>;   

    @<span class="pl-en">field</span>() 
    @<span class="pl-en">number</span>() <span class="pl-c">// to ensure that this attribute is integer</span>
    age: <span class="pl-k">number</span>; 

    @<span class="pl-en">field</span>() 
    @<span class="pl-en">email</span>() <span class="pl-c">// to ensure that this attribute is in mail format</span>
    email: <span class="pl-k">string</span>; 

    @<span class="pl-en">field</span>() 
    @<span class="pl-en">length</span>(10) <span class="pl-c">// to ensure that this attribute is not having more than 10 char, and all char are numbers</span>
    mobileNumber: <span class="pl-k">string</span>; 

    @<span class="pl-en">field</span>() 
    @<span class="pl-en">min</span>(10)
    @<span class="pl-en">max</span>(20)<span class="pl-c">// to ensure that this attribute is not more than 20 and not less than 10</span>
    count: <span class="pl-k">number</span>;      
} </pre></div>

<p>The user will have freedom to choose the entity attribute to be validated before save or update.</p>

<p><a href="https://node-data.atlassian.net/secure/RapidBoard.jspa?rapidView=2&amp;view=detail">JIRA URL</a> </p>

<p><img src="https://raw.githubusercontent.com/ratneshsinghparihar/Node-Data/master/images/talentica.png" width="200">
<img src="https://raw.githubusercontent.com/ratneshsinghparihar/Node-Data/master/images/atlassian.png" width="200">
<img src="https://raw.githubusercontent.com/ratneshsinghparihar/Node-Data/master/images/realsociable.png" width="200"></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/ratneshsinghparihar/Node-Data">Node-data</a> is maintained by <a href="https://github.com/ratneshsinghparihar">ratneshsinghparihar</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
